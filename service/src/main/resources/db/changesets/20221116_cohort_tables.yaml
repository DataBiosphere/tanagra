databaseChangeLog:
  - changeSet:
      id: initial_cohort_tables
      author: marikomedlock
      changes:
        - createTable:
            tableName: cohort
            columns:
              - column:
                  name: study_id
                  type: text
                  constraints:
                    references: study(study_id)
                    foreignKeyName: fk_cohort_study_id
                    nullable: false
                    deleteCascade: true
                  remarks: Deleting a study will cascade to delete the cohorts contained in it
              - column:
                  name: cohort_id
                  type: text
                  constraints:
                    primaryKey: true
                    nullable: false
                    unique: true
              - column:
                  name: underlay_name
                  type: text
                  constraints:
                    nullable: false
                    unique: false
              - column:
                  name: cohort_revision_group_id
                  type: text
                  constraints:
                    nullable: false
                    unique: false
              - column:
                  name: version
                  type: integer
                  constraints:
                    nullable: false
                    unique: false
              - column:
                  name: is_most_recent
                  type: boolean
                  constraints:
                    nullable: false
                    unique: false
              - column:
                  name: is_editable
                  type: boolean
                  constraints:
                    nullable: false
                    unique: false
              - column:
                  name: last_modified
                  type: timestamp
                  constraints:
                    nullable: true
                    unique: false
              - column:
                  name: display_name
                  type: text
                  constraints:
                    nullable: true
                    unique: false
              - column:
                  name: description
                  type: text
                  constraints:
                    nullable: true
                    unique: false

        - createTable:
            tableName: concept_set
            columns:
              - column:
                  name: study_id
                  type: text
                  constraints:
                    references: study(study_id)
                    foreignKeyName: fk_concept_set_study_id
                    nullable: false
                    deleteCascade: true
                  remarks: Deleting a study will cascade to delete the concept sets contained in it
              - column:
                  name: concept_set_id
                  type: text
                  constraints:
                    primaryKey: true
                    nullable: false
                    unique: true
              - column:
                  name: underlay_name
                  type: text
                  constraints:
                    nullable: false
                    unique: false
              - column:
                  name: entity_name
                  type: text
                  constraints:
                    nullable: false
                    unique: false
              - column:
                  name: last_modified
                  type: timestamp
                  constraints:
                    nullable: true
                    unique: false
              - column:
                  name: display_name
                  type: text
                  constraints:
                    nullable: true
                    unique: false
              - column:
                  name: description
                  type: text
                  constraints:
                    nullable: true
                    unique: false

        - createTable:
            tableName: criteria_group
            columns:
              - column:
                  name: cohort_id
                  type: text
                  constraints:
                    references: cohort(cohort_id)
                    foreignKeyName: fk_criteria_group_cohort_id
                    nullable: false
                    deleteCascade: true
                  remarks: Deleting a cohort will cascade to delete the criteria groups contained in it
              - column:
                  name: criteria_group_id
                  type: text
                  constraints:
                    primaryKey: true
                    nullable: false
                    unique: true
              - column:
                  name: user_facing_criteria_group_id
                  type: text
                  constraints:
                    nullable: false
                    unique: false
              - column:
                  name: display_name
                  type: text
                  constraints:
                    nullable: true
                    unique: false
              - column:
                  name: operator
                  type: text
                  constraints:
                    nullable: false
                    unique: false
              - column:
                  name: is_excluded
                  type: boolean
                  constraints:
                    nullable: false
                    unique: false

        - createTable:
            tableName: criteria
            columns:
              - column:
                  name: criteria_group_id
                  type: text
                  constraints:
                    references: criteria_group(criteria_group_id)
                    foreignKeyName: fk_criteria_criteria_group_id
                    nullable: true
                    deleteCascade: true
                  remarks: Deleting a criteria group will cascade to delete the criteria contained in it
              - column:
                  name: concept_set_id
                  type: text
                  constraints:
                    references: concept_set(concept_set_id)
                    foreignKeyName: fk_criteria_concept_set_id
                    nullable: true
                    deleteCascade: true
                  remarks: Deleting a concept set will cascade to delete the criteria contained in it
              - column:
                  name: criteria_id
                  type: text
                  constraints:
                    primaryKey: true
                    nullable: false
                    unique: true
              - column:
                  name: user_facing_criteria_id
                  type: text
                  constraints:
                    nullable: false
                    unique: false
              - column:
                  name: display_name
                  type: text
                  constraints:
                    nullable: true
                    unique: false
              - column:
                  name: plugin_name
                  type: text
                  constraints:
                    nullable: false
                    unique: false
              - column:
                  name: selection_data
                  type: text
                  constraints:
                    nullable: false
                    unique: false
              - column:
                  name: ui_config
                  type: text
                  constraints:
                    nullable: true
                    unique: false
