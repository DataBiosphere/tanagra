# An Underlay yaml file describing a fictional relational domain of sailors, boats and
# reservations for testing.
# This should be equivalent to nautical.pbtext.

name: nautical_underlay
entities:
  - name: sailors
    attributes:
      - name: id
        dataType: INT64
      - name: name
        dataType: STRING
      - name: rating
        dataType: INT64
  - name: boats
    attributes:
      - name: id
        dataType: INT64
      - name: name
        dataType: STRING
      - name: color
        dataType: STRING
      - name: type_id
        dataType: INT64
      - name: type_name
        dataType: STRING
  - name: reservations
    attributes:
      - name: id
        dataType: INT64
      - name: sailors_id
        dataType: INT64
      - name: boats_id
        dataType: INT64
      - name: day
        dataType: STRING
  - name: boat_engines
    attributes:
      - name: id
        dataType: INT64
      - name: name
        dataType: STRING
  - name: boat_electric_anchors
    attributes:
      - name: id
        dataType: INT64
      - name: name
        dataType: STRING
criteriaConfigs: >
  [{"type":"concept","title":"Conditions","defaultName":"Contains Conditions Codes","plugin":{"columns":[{"key":"concept_name","width":"100%","title":"Concept Name"},{"key":"concept_id","width":120,"title":"Concept ID"},{"key":"standard_concept","width":180,"title":"Source/Standard"},{"key":"vocabulary_id","width":120,"title":"Vocab"},{"key":"concept_code","width":120,"title":"Code"}],"entities":[{"name":"condition","selectable":true,"hierarchical":true}]}},{"type":"concept","title":"Procedures","defaultName":"Contains Procedures Codes","plugin":{"columns":[{"key":"concept_name","width":"100%","title":"Concept Name"},{"key":"concept_id","width":120,"title":"Concept ID"},{"key":"standard_concept","width":180,"title":"Source/Standard"},{"key":"vocabulary_id","width":120,"title":"Vocab"},{"key":"concept_code","width":120,"title":"Code"}],"entities":[{"name":"procedure","selectable":true,"hierarchical":true}]}},{"type":"concept","title":"Observations","defaultName":"Contains Observations Codes","plugin":{"columns":[{"key":"concept_name","width":"100%","title":"Concept Name"},{"key":"concept_id","width":120,"title":"Concept ID"},{"key":"standard_concept","width":180,"title":"Source/Standard"},{"key":"vocabulary_id","width":120,"title":"Vocab"},{"key":"concept_code","width":120,"title":"Code"}],"entities":[{"name":"observation","selectable":true}]}},{"type":"concept","title":"Drugs","defaultName":"Contains Drugs Codes","plugin":{"columns":[{"key":"concept_name","width":"100%","title":"Concept Name"},{"key":"concept_id","width":120,"title":"Concept ID"},{"key":"standard_concept","width":180,"title":"Source/Standard"},{"key":"vocabulary_id","width":120,"title":"Vocab"},{"key":"concept_code","width":120,"title":"Code"}],"entities":[{"name":"ingredient","selectable":true,"hierarchical":true},{"name":"brand","sourceConcepts":true,"attributes":["concept_name","concept_id","standard_concept","concept_code"],"listChildren":{"entity":"ingredient","idPath":"relationshipFilter.filter.binaryFilter.attributeValue","filter":{"relationshipFilter":{"outerVariable":"ingredient","newVariable":"brand","newEntity":"brand","filter":{"binaryFilter":{"attributeVariable":{"variable":"brand","name":"concept_id"},"operator":"EQUALS","attributeValue":{"int64Val":0}}}}}}}]}},{"type":"attribute","title":"Ethnicity","defaultName":"Contains Ethnicity Codes","plugin":{"attribute":"ethnicity_concept_id"}},{"type":"attribute","title":"Gender Identity","defaultName":"Contains Gender Identity Codes","plugin":{"attribute":"gender_concept_id"}},{"type":"attribute","title":"Race","defaultName":"Contains Race Codes","plugin":{"attribute":"race_concept_id"}},{"type":"attribute","title":"Sex Assigned at Birth","defaultName":"Contains Sex Assigned at Birth Codes","plugin":{"attribute":"sex_at_birth_concept_id"}},{"type":"attribute","title":"Year at Birth","defaultName":"Contains Year at Birth Values","plugin":{"attribute":"year_of_birth"}}]
relationships:
  - name: sailor_reservation
    entity1: sailors
    entity2: reservations
  - name: boat_reservation
    entity1: boats
    entity2: reservations
  - name: sailor_boat
    entity1: sailors
    entity2: boats
datasets:
  - name: nautical
    bigQueryDataset:
      projectId: my-project-id
      datasetId: nautical
    tables:
      - name: sailors
        columns:
          - name: s_id
            dataType: INT64
          - name: s_name
            dataType: STRING
          - name: rating
            dataType: INT64
      - name: boats
        columns:
          - name: b_id
            dataType: INT64
          - name: b_name
            dataType: STRING
          - name: color
            dataType: STRING
          - name: bt_id
            dataType: INT64
      - name: sailors_favorite_boats
        columns:
          - name: sfb_id
            dataType: INT64
          - name: s_id
            dataType: INT64
          - name: b_id
            dataType: INT64
      - name: reservations
        columns:
          - name: r_id
            dataType: INT64
          - name: s_id
            dataType: INT64
          - name: b_id
            dataType: INT64
          - name: day
            dataType: STRING
      - name: boat_types
        columns:
          - name: bt_id
            dataType: INT64
          - name: bt_name
            dataType: STRING
      - name: boat_types_descendants
        columns:
          - name: bt_ancestor
            dataType: INT64
          - name: bt_descendant
            dataType: INT64
      - name: boat_types_children
        columns:
          - name: btc_parent
            dataType: INT64
          - name: btc_child
            dataType: INT64
          - name: btc_is_expired
            dataType: STRING
      - name: boat_types_paths
        columns:
          - name: bt_node
            dataType: INT64
          - name: bt_path
            dataType: STRING
          - name: bt_num_children
            dataType: INT64
      - name: boat_parts
        columns:
          - name: bp_id
            dataType: INT64
          - name: bp_name
            dataType: STRING
          - name: bp_type
            dataType: STRING
          - name: bp_requires_electricity
            dataType: STRING
entityMappings:
  - entity: sailors
    primaryKey:
      dataset: nautical
      table: sailors
      column: s_id
  - entity: boats
    primaryKey:
      dataset: nautical
      table: boats
      column: b_id
  - entity: reservations
    primaryKey:
      dataset: nautical
      table: reservations
      column: r_id
  - entity: boat_engines
    primaryKey:
      dataset: nautical
      table: boat_parts
      column: bp_id
    tableFilter:
      binaryColumnFilter:
        column:
          dataset: nautical
          table: boat_parts
          column: bp_type
        operator: EQUALS
        stringVal: engine
  - entity: boat_electric_anchors
    primaryKey:
      dataset: nautical
      table: boat_parts
      column: bp_id
    tableFilter:
      arrayColumnFilter:
        operator: AND
        binaryColumnFilters:
          - column:
              dataset: nautical
              table: boat_parts
              column: bp_type
            operator: EQUALS
            stringVal: anchor
          - column:
              dataset: nautical
              table: boat_parts
              column: bp_requires_electricity
            operator: EQUALS
            stringVal: true
attributeMappings:
  - attribute:
      entity: sailors
      attribute: id
    simpleColumn:
      columnId:
        dataset: nautical
        table: sailors
        column: s_id
  - attribute:
      entity: sailors
      attribute: name
    simpleColumn:
      columnId:
        dataset: nautical
        table: sailors
        column: s_name
  - attribute:
      entity: sailors
      attribute: rating
    simpleColumn:
      columnId:
        dataset: nautical
        table: sailors
        column: rating
  - attribute:
      entity: boats
      attribute: id
    simpleColumn:
      columnId:
        dataset: nautical
        table: boats
        column: b_id
  - attribute:
      entity: boats
      attribute: name
    simpleColumn:
      columnId:
        dataset: nautical
        table: boats
        column: b_name
  - attribute:
      entity: boats
      attribute: color
    simpleColumn:
      columnId:
        dataset: nautical
        table: boats
        column: color
  - attribute:
      entity: boats
      attribute: type_id
    simpleColumn:
      columnId:
        dataset: nautical
        table: boats
        column: bt_id
  - attribute:
      entity: boats
      attribute: type_name
    lookupColumn:
      primaryTableLookupKey:
        dataset: nautical
        table: boats
        column: bt_id
      lookupTableKey:
        dataset: nautical
        table: boat_types
        column: bt_id
      lookupColumn:
        dataset: nautical
        table: boat_types
        column: bt_name
  - attribute:
      entity: reservations
      attribute: id
    simpleColumn:
      columnId:
        dataset: nautical
        table: reservations
        column: r_id
  - attribute:
      entity: reservations
      attribute: sailors_id
    simpleColumn:
      columnId:
        dataset: nautical
        table: reservations
        column: s_id
  - attribute:
      entity: reservations
      attribute: boats_id
    simpleColumn:
      columnId:
        dataset: nautical
        table: reservations
        column: b_id
  - attribute:
      entity: reservations
      attribute: day
    simpleColumn:
      columnId:
        dataset: nautical
        table: reservations
        column: day
  - attribute:
      entity: boat_engines
      attribute: id
    simpleColumn:
      columnId:
        dataset: nautical
        table: boat_parts
        column: bp_id
  - attribute:
      entity: boat_engines
      attribute: name
    simpleColumn:
      columnId:
        dataset: nautical
        table: boat_parts
        column: bp_name
  - attribute:
      entity: boat_electric_anchors
      attribute: id
    simpleColumn:
      columnId:
        dataset: nautical
        table: boat_parts
        column: bp_id
  - attribute:
      entity: boat_electric_anchors
      attribute: name
    simpleColumn:
      columnId:
        dataset: nautical
        table: boat_parts
        column: bp_name
relationshipMappings:
  - name: sailor_reservation
    foreignKey:
      primaryKey:
        dataset: nautical
        table: sailors
        column: s_id
      foreignKey:
        dataset: nautical
        table: reservations
        column: s_id
  - name: boat_reservation
    foreignKey:
      primaryKey:
        dataset: nautical
        table: boats
        column: b_id
      foreignKey:
        dataset: nautical
        table: reservations
        column: b_id
  - name: sailor_boat
    intermediateTable:
      entity1EntityTableKey:
        dataset: nautical
        table: sailors
        column: s_id
      entity1IntermediateTableKey:
        dataset: nautical
        table: sailors_favorite_boats
        column: s_id
      entity2EntityTableKey:
        dataset: nautical
        table: boats
        column: b_id
      entity2IntermediateTableKey:
        dataset: nautical
        table: sailors_favorite_boats
        column: b_id
hierarchies:
  - attribute:
      entity: boats
      attribute: type_id
    descendantsTable:
      ancestor:
        dataset: nautical
        table: boat_types_descendants
        column: bt_ancestor
      descendant:
        dataset: nautical
        table: boat_types_descendants
        column: bt_descendant
    childrenTable:
      parent:
        dataset: nautical
        table: boat_types_children
        column: btc_parent
      child:
        dataset: nautical
        table: boat_types_children
        column: btc_child
      tableFilter:
        binaryColumnFilter:
          column:
            dataset: nautical
            table: boat_types_children
            column: btc_is_expired
          operator: EQUALS
          stringVal: false
    pathsTable:
      node:
        dataset: nautical
        table: boat_types_paths
        column: bt_node
      path:
        dataset: nautical
        table: boat_types_paths
        column: bt_path
      numChildren:
        dataset: nautical
        table: boat_types_paths
        column: bt_num_children
textSearchInformation:
  - entity: sailors
    textTable:
      lookupTableKey:
        dataset: nautical
        table: sailors
        column: s_id
      fullText:
        dataset: nautical
        table: sailors
        column: s_name
entityFiltersSchemas:
  - entity: sailors
    attributes:
      - attributeName: rating
        integerBoundsHint:
          min: 0
          max: 10
      - attributeName: name
    relationships:
      - relationshipName: sailor_reservation
  - entity: boats
    relationships:
      - relationshipName: sailor_boat
  - entity: reservations
    attributes:
      - attributeName: day
        enumHint:
          enumHintValues:
            - displayName: "Monday"
              stringVal: "MONDAY"
            - displayName: "Tuesday"
              stringVal: "TUESDAY"
            - displayName: "Wednesday"
              stringVal: "WEDNESDAY"
