# Tanagra Service
The API service backing the Tanagra application.

Images hosted at [gcr.io/broad-dsp-gcr-public/tanagra-api](gcr.io/broad-dsp-gcr-public/tanagra-api).

# Development

Initialize a local postgres container, see [local-dev README.md](local-dev/README.md).
```sh
./api/local-dev/run_postgres.sh start
```
To get started, run `./gradlew api:build` to build and test.

## Local Server
`./gradlew bootRun` starts a local server
on localhost:8080. See [http://localhost:8080/swagger-ui.html](http://localhost:8080/swagger-ui.html)
for the Swagger API page.

## Adding dependencies
We use [Gradle dependency locking](https://docs.gradle.org/current/userguide/dependency_locking.html)
for building with deterministic dependencies. When adding a new dependency, use

`./gradlew api:dependencies --write-locks`

to regenerate the `gradle.lockfile` with the added dependencies. If this is not done, building will
error about
> Could not resolve all files for configuration...
> Resolved foo.bar:lib:version which is not part of the dependency lock state

## Generating SQL strings for tests
Some tests compare the SQL string generated by the API code with an expected string, stored in a golden file.
An example test is `bio.terra.tanagra.aousynthethic.BrandEntityQueriesTest.generateSqlForAllBrandEntities` and
the accompanying golden file is `api/src/test/resources/aousynthetic.all-brand-entities.sql`.

To regenerate the golden files, run the tests with the `generateSqlFiles` Gradle project property set. e.g.:
`./gradlew cleanTest api:test --tests bio.terra.tanagra.aousynthetic.* --info -PgenerateSqlFiles=true`